{% extends 'base.html' %}

{% block title %}Crear cuenta - {{ site_name }}{% endblock %}
{% block meta_robots %}noindex, nofollow{% endblock %}
{% block main_class %}pt-16{% endblock %}

{% block content %}
<section class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center py-12 px-4">
    <div class="w-full max-w-md">
        <!-- Logo / Brand -->
        <div class="text-center mb-8">
            <a href="{% url 'core:home' %}" class="inline-block">
                <div class="w-16 h-16 bg-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-red-600/30">
                    <i class="fas fa-user-plus text-white text-2xl"></i>
                </div>
            </a>
            <h1 class="text-3xl font-extrabold text-white">Crear cuenta</h1>
            <p class="text-gray-400 mt-2">Regístrate para acceder a tu panel</p>
        </div>

        <!-- Card -->
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <!-- Global errors -->
            {% if form.non_field_errors %}
            <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-center text-sm">
                <i class="fas fa-exclamation-circle mr-2 flex-shrink-0"></i>
                <span>{{ form.non_field_errors.0 }}</span>
            </div>
            {% endif %}

            <form method="post" action="{% url 'signup' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}" autocomplete="off">
                {% csrf_token %}
                {{ form.website_url }}

                <!-- Nombre y Apellido -->
                <div class="grid grid-cols-2 gap-4 mb-5">
                    <div>
                        <label for="id_first_name" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-user text-gray-400 mr-1"></i> Nombre
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                        <p class="text-xs text-red-500 mt-1">{{ form.first_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    <div>
                        <label for="id_last_name" class="block text-sm font-semibold text-gray-700 mb-2">
                            Apellido
                        </label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                        <p class="text-xs text-red-500 mt-1">{{ form.last_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Email -->
                <div class="mb-5">
                    <label for="id_email" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-envelope text-gray-400 mr-1"></i> Correo electrónico
                    </label>
                    {{ form.email }}
                    {% if form.email.errors %}
                    <p class="text-xs text-red-500 mt-1">{{ form.email.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Teléfono -->
                <div class="mb-5">
                    <label for="id_phone" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-phone text-gray-400 mr-1"></i> Teléfono <span class="text-gray-400 font-normal">(opcional)</span>
                    </label>
                    {{ form.phone }}
                    {% if form.phone.errors %}
                    <p class="text-xs text-red-500 mt-1">{{ form.phone.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Contraseña -->
                <div class="mb-3">
                    <label for="id_password1" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lock text-gray-400 mr-1"></i> Contraseña
                    </label>
                    {{ form.password1 }}
                    {% if form.password1.errors %}
                    {% for err in form.password1.errors %}
                    <p class="text-xs text-red-500 mt-1">{{ err }}</p>
                    {% endfor %}
                    {% endif %}
                </div>

                <!-- Password strength indicator -->
                <div class="mb-5">
                    <div class="flex gap-1 mb-1.5">
                        <div id="str-1" class="h-1 flex-1 rounded-full bg-gray-200 transition-colors"></div>
                        <div id="str-2" class="h-1 flex-1 rounded-full bg-gray-200 transition-colors"></div>
                        <div id="str-3" class="h-1 flex-1 rounded-full bg-gray-200 transition-colors"></div>
                        <div id="str-4" class="h-1 flex-1 rounded-full bg-gray-200 transition-colors"></div>
                    </div>
                    <p id="str-text" class="text-xs text-gray-400"></p>
                    <ul class="mt-2 space-y-0.5 text-xs text-gray-400">
                        <li id="req-len"><i class="fas fa-circle text-[6px] mr-1.5"></i>Mínimo 8 caracteres</li>
                        <li id="req-upper"><i class="fas fa-circle text-[6px] mr-1.5"></i>Una letra mayúscula</li>
                        <li id="req-lower"><i class="fas fa-circle text-[6px] mr-1.5"></i>Una letra minúscula</li>
                        <li id="req-num"><i class="fas fa-circle text-[6px] mr-1.5"></i>Un número</li>
                        <li id="req-special"><i class="fas fa-circle text-[6px] mr-1.5"></i>Un carácter especial</li>
                    </ul>
                </div>

                <!-- Confirmar contraseña -->
                <div class="mb-5">
                    <label for="id_password2" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lock text-gray-400 mr-1"></i> Confirmar contraseña
                    </label>
                    {{ form.password2 }}
                    {% if form.password2.errors %}
                    <p class="text-xs text-red-500 mt-1">{{ form.password2.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Terms -->
                <div class="mb-6">
                    <label class="flex items-start gap-2 cursor-pointer">
                        <input type="checkbox" name="accept_terms" class="mt-0.5 w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500" {% if form.accept_terms.value %}checked{% endif %}>
                        <span class="text-xs text-gray-600">
                            Acepto los <a href="{% url 'core:terms' %}" target="_blank" class="text-red-600 hover:underline">términos y condiciones</a>
                            y la <a href="{% url 'core:privacy' %}" target="_blank" class="text-red-600 hover:underline">política de privacidad</a>
                        </span>
                    </label>
                    {% if form.accept_terms.errors %}
                    <p class="text-xs text-red-500 mt-1">{{ form.accept_terms.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Submit -->
                <button type="submit" class="w-full inline-flex items-center justify-center px-6 py-3.5 text-base font-bold text-white bg-red-600 rounded-lg shadow-lg shadow-red-600/30 hover:bg-red-700 transition-all duration-300 transform hover:scale-[1.02]">
                    <i class="fas fa-user-plus mr-2"></i>
                    Crear mi cuenta
                </button>
            </form>

            <!-- Divider -->
            <div class="flex items-center my-6">
                <div class="flex-1 h-px bg-gray-200"></div>
                <span class="px-4 text-xs text-gray-400 uppercase">o</span>
                <div class="flex-1 h-px bg-gray-200"></div>
            </div>

            <!-- Links -->
            <div class="flex items-center justify-center gap-6 text-sm">
                <a href="{% url 'login' %}" class="text-red-600 hover:text-red-700 transition font-medium">
                    <i class="fas fa-sign-in-alt mr-1"></i> Ya tengo cuenta
                </a>
                <a href="{% url 'core:home' %}" class="text-gray-500 hover:text-red-600 transition font-medium">
                    <i class="fas fa-arrow-left mr-1"></i> Volver al inicio
                </a>
            </div>
        </div>

        <!-- Footer -->
        <p class="text-center text-gray-500 text-xs mt-6">
            <i class="fas fa-shield-alt mr-1"></i>
            Conexión segura y protegida
        </p>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    var pw = document.getElementById('id_password1');
    if (!pw) return;

    var bars = [
        document.getElementById('str-1'),
        document.getElementById('str-2'),
        document.getElementById('str-3'),
        document.getElementById('str-4')
    ];
    var strText = document.getElementById('str-text');
    var reqs = {
        len:     document.getElementById('req-len'),
        upper:   document.getElementById('req-upper'),
        lower:   document.getElementById('req-lower'),
        num:     document.getElementById('req-num'),
        special: document.getElementById('req-special')
    };

    var levels = [
        { color: 'bg-red-500',    label: 'Muy débil' },
        { color: 'bg-orange-400', label: 'Débil' },
        { color: 'bg-yellow-400', label: 'Aceptable' },
        { color: 'bg-green-500',  label: 'Fuerte' }
    ];

    function check(val) {
        var score = 0;
        var checks = {
            len:     val.length >= 8,
            upper:   /[A-Z]/.test(val),
            lower:   /[a-z]/.test(val),
            num:     /\d/.test(val),
            special: /[!@#$%^&*(),.?":{}|<>\-_=+]/.test(val)
        };

        for (var k in checks) {
            var el = reqs[k];
            if (checks[k]) {
                score++;
                el.classList.remove('text-gray-400');
                el.classList.add('text-green-600');
                el.querySelector('i').classList.remove('fa-circle');
                el.querySelector('i').classList.add('fa-check-circle');
            } else {
                el.classList.remove('text-green-600');
                el.classList.add('text-gray-400');
                el.querySelector('i').classList.remove('fa-check-circle');
                el.querySelector('i').classList.add('fa-circle');
            }
        }

        var lvl = Math.min(Math.floor(score * 4 / 5), 3);
        if (val.length === 0) lvl = -1;

        for (var i = 0; i < 4; i++) {
            bars[i].className = 'h-1 flex-1 rounded-full transition-colors ' +
                (i <= lvl ? levels[lvl].color : 'bg-gray-200');
        }
        strText.textContent = lvl >= 0 ? levels[lvl].label : '';
    }

    pw.addEventListener('input', function() { check(this.value); });
})();
</script>
{% endblock %}
