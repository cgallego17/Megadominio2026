{% extends 'core/dashboard_base.html' %}
{% load humanize %}

{% block dashboard_title %}Factura {{ invoice.number }}{% endblock %}
{% block dashboard_heading %}{{ invoice.number }}{% endblock %}
{% block dashboard_desc %}Factura para {{ invoice.client.name }}{% endblock %}

{% block dashboard_actions %}
<button onclick="window.print()" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-lg hover:bg-blue-700 transition">
    <i class="fas fa-print"></i> Imprimir
</button>
<a href="{% url 'core:dashboard_invoice_pdf' invoice.pk %}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white text-sm font-semibold rounded-lg hover:bg-purple-700 transition">
    <i class="fas fa-file-pdf"></i> Descargar PDF
</a>
{% if invoice.status == 'pending' %}
<form method="post" action="{% url 'core:dashboard_invoice_mark_paid' invoice.pk %}" class="inline">
    {% csrf_token %}
    <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 transition">
        <i class="fas fa-check"></i> Marcar pagada
    </button>
</form>
{% endif %}
<a href="{% url 'core:dashboard_invoice_edit' invoice.pk %}" class="inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700 transition">
    <i class="fas fa-edit"></i> Editar
</a>
<a href="{% url 'core:dashboard_invoice_delete' invoice.pk %}" class="inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-red-400 text-sm font-semibold rounded-lg hover:bg-red-500/10 transition">
    <i class="fas fa-trash"></i> Eliminar
</a>
<a href="{% url 'core:dashboard_invoices' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-gray-800 text-gray-300 text-sm font-semibold rounded-lg hover:bg-gray-700 transition">
    <i class="fas fa-arrow-left"></i> Volver
</a>
{% endblock %}

{% block dashboard_content %}
<!-- Info Card -->
<div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden mb-6">
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-800">
        <h3 class="text-sm font-bold text-white">Informaci贸n de la factura</h3>
        <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-bold {% if invoice.status == 'paid' %}bg-green-500/10 text-green-400{% elif invoice.status == 'pending' %}bg-amber-500/10 text-amber-400{% elif invoice.status == 'overdue' %}bg-red-500/10 text-red-400{% else %}bg-gray-700/50 text-gray-400{% endif %}">
            {{ invoice.get_status_display }}
        </span>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-3">
                <div>
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider mb-1">Cliente</p>
                    <a href="{% url 'core:dashboard_client_detail' invoice.client.pk %}" class="text-red-400 hover:text-red-300 font-semibold text-sm transition">{{ invoice.client.name }}</a>
                </div>
                <div>
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider mb-1">Cotizaci贸n</p>
                    <a href="{% url 'core:dashboard_quote_detail' invoice.quote.pk %}" class="text-red-400 hover:text-red-300 font-semibold text-sm transition">{{ invoice.quote.number }}</a>
                </div>
                <div>
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider mb-1">Fecha emisi贸n</p>
                    <p class="text-white text-sm">{{ invoice.issue_date|date:"d/m/Y" }}</p>
                </div>
                <div>
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider mb-1">Fecha vencimiento</p>
                    <p class="text-white text-sm">{{ invoice.due_date|date:"d/m/Y" }}</p>
                </div>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between"><span class="text-gray-500 text-sm">Subtotal</span><span class="text-gray-300 text-sm">${{ invoice.subtotal|floatformat:0|intcomma }} COP</span></div>
                <div class="flex justify-between"><span class="text-gray-500 text-sm">Descuento</span><span class="text-gray-300 text-sm">${{ invoice.discount_amount|floatformat:0|intcomma }} COP</span></div>
                <div class="flex justify-between"><span class="text-gray-500 text-sm">Impuesto</span><span class="text-gray-300 text-sm">${{ invoice.tax_amount|floatformat:0|intcomma }} COP</span></div>
                <div class="flex justify-between pt-2 border-t border-gray-800"><span class="text-white font-bold">Total</span><span class="text-white font-extrabold text-lg">${{ invoice.total|floatformat:0|intcomma }} COP</span></div>
            </div>
        </div>
    </div>
</div>

<!-- Items Table -->
<div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-800">
        <h3 class="text-sm font-bold text-white">Items</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead>
                <tr class="border-b border-gray-800">
                    <th class="px-5 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Servicio</th>
                    <th class="px-5 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Descripci贸n</th>
                    <th class="px-5 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Cant.</th>
                    <th class="px-5 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Precio unit.</th>
                    <th class="px-5 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Subtotal</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-800/50">
                {% for item in invoice.items.all %}
                <tr class="hover:bg-gray-800/40 transition">
                    <td class="px-5 py-3.5 text-sm text-white font-semibold">{{ item.service.name }}</td>
                    <td class="px-5 py-3.5 text-sm text-gray-400">{{ item.description }}</td>
                    <td class="px-5 py-3.5 text-sm text-gray-300">{{ item.quantity }}</td>
                    <td class="px-5 py-3.5 text-sm text-gray-300">${{ item.unit_price|floatformat:0|intcomma }}</td>
                    <td class="px-5 py-3.5 text-sm text-white font-bold">${{ item.subtotal|floatformat:0|intcomma }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
@media print {
    nav, header, .dashboard-sidebar, button:not(.print-only), a[href*="edit"], a[href*="delete"], form {
        display: none !important;
    }
    
    body {
        background: white !important;
        color: black !important;
    }
    
    .bg-gray-900, .bg-gray-800 {
        background: white !important;
        border: 1px solid #e5e7eb !important;
    }
    
    .text-white, .text-gray-300, .text-gray-400, .text-gray-500 {
        color: #000 !important;
    }
    
    .text-red-400 {
        color: #dc2626 !important;
    }
    
    .border-gray-800, .border-gray-700 {
        border-color: #e5e7eb !important;
    }
    
    * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    
    main {
        margin: 0 !important;
        padding: 20px !important;
    }
}
</style>
{% endblock %}
