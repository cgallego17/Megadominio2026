{% extends 'base.html' %}
{% load humanize %}

{% block title %}{{ plan.title }} - {{ site_name }}{% endblock %}
{% block meta_description %}Detalle del plan {{ plan.title }} de {{ site_name }}. Incluye características, precio y opciones de compra.{% endblock %}

{% block main_class %}pt-16{% endblock %}

{% block content %}
<section class="relative bg-gradient-to-b from-gray-950 via-gray-900 to-gray-950 text-white overflow-hidden py-16">
  <div class="max-w-5xl mx-auto px-4">
    <div class="mb-8">
      <a href="javascript:history.back()" class="text-sm text-gray-400 hover:text-red-400 transition inline-flex items-center gap-2">
        <i class="fas fa-arrow-left"></i> Volver
      </a>
    </div>

    <div class="bg-gray-900 border border-gray-800 rounded-2xl p-7 shadow-xl">
      <div class="flex items-start gap-5 mb-6">
        <div class="w-16 h-16 rounded-xl bg-red-600/20 text-red-400 flex items-center justify-center overflow-hidden flex-shrink-0">
          {% if plan.image %}
          <img src="{{ plan.image }}" alt="{{ plan.title }}" class="w-full h-full object-cover" loading="lazy" referrerpolicy="no-referrer" onerror="this.onerror=null;this.src='/static/img/icon.png';">
          {% else %}
          <i class="fas {{ plan.icon|default:'fa-tag' }} text-2xl"></i>
          {% endif %}
        </div>
        <div class="flex-1 min-w-0">
          <h1 class="text-3xl md:text-4xl font-extrabold mb-1">{{ plan.title }}</h1>
          {% if plan.description %}
          <p class="text-gray-400 text-sm">{{ plan.description }}</p>
          {% else %}
          <p class="text-gray-400 text-sm">Plan digital de {{ site_name }}</p>
          {% endif %}
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">
        <div class="md:col-span-2">
          <h2 class="text-xl font-bold mb-3">¿Qué incluye?</h2>
          <ul class="space-y-3 text-gray-300">
            {% for f in plan.features %}
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-green-500 mt-0.5"></i>
              <span>{{ f }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        <aside class="bg-gray-800/60 border border-gray-700 rounded-2xl p-5">
          <p class="text-gray-400 text-sm mb-1">Precio</p>
          <div class="flex items-baseline gap-2 mb-4">
            <span class="text-4xl font-extrabold">${{ plan.price|intcomma }}</span>
            {% if plan.period %}
            <span class="text-gray-400 text-sm font-semibold">/ {{ plan.period }}</span>
            {% endif %}
          </div>
          <div class="space-y-2">
            <button id="plan-add-to-cart" class="w-full px-5 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition inline-flex items-center justify-center">
              <i class="fas fa-cart-plus mr-2"></i> Agregar al carrito
            </button>
            <button id="plan-buy-now" class="w-full px-5 py-3 border-2 border-gray-700 text-white bg-gray-800 hover:bg-gray-700 font-bold rounded-lg transition inline-flex items-center justify-center">
              <i class="fas fa-bolt mr-2"></i> Comprar ahora
            </button>
          </div>
          <p class="text-xs text-gray-500 mt-3">Este es un producto digital. Envío: $0</p>
        </aside>
      </div>
    </div>

    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-gray-900 border border-gray-800 rounded-2xl p-7 flex items-center justify-center h-56">
        <div class="relative w-40 h-40">
          <div class="absolute inset-0 rounded-2xl bg-gradient-to-tr from-red-600/30 via-red-400/20 to-pink-500/20 blur-2xl"></div>
          <div class="relative w-full h-full rounded-2xl bg-gray-800/60 border border-gray-700 flex items-center justify-center overflow-hidden">
            {% if plan.image %}
            <img src="{{ plan.image }}" alt="{{ plan.title }}" class="w-32 h-32 object-contain" loading="lazy" referrerpolicy="no-referrer" onerror="this.onerror=null;this.src='/static/img/icon.png';">
            {% else %}
            <i class="fas {{ plan.icon|default:'fa-tag' }} text-6xl text-red-400"></i>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="md:col-span-2 bg-gray-900 border border-gray-800 rounded-2xl p-7">
        <h2 class="text-xl font-bold mb-3">Preguntas frecuentes</h2>
        <div class="space-y-3">
          <details class="group bg-gray-800/50 rounded-xl p-4 border border-gray-700">
            <summary class="cursor-pointer text-white font-semibold flex items-center justify-between">
              <span>¿Cuál es el tiempo de entrega estimado?</span>
              <i class="fas fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <div class="mt-3 text-gray-300 text-sm">Depende del alcance: una landing suele tardar 3–7 días, un sitio corporativo 1–2 semanas y un e‑commerce 2–4 semanas. Si ya tienes contenidos listos, podemos acelerar.</div>
          </details>
          <details class="group bg-gray-800/50 rounded-xl p-4 border border-gray-700">
            <summary class="cursor-pointer text-white font-semibold flex items-center justify-between">
              <span>¿Puedo escalar o cambiar de plan más adelante?</span>
              <i class="fas fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <div class="mt-3 text-gray-300 text-sm">Sí. Puedes actualizar o migrar entre planes cuando lo necesites. Hacemos prorrateos justos y cuidamos la continuidad operativa.</div>
          </details>
          <details class="group bg-gray-800/50 rounded-xl p-4 border border-gray-700">
            <summary class="cursor-pointer text-white font-semibold flex items-center justify-between">
              <span>¿Incluye dominio, hosting y SSL?</span>
              <i class="fas fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <div class="mt-3 text-gray-300 text-sm">Según el plan: si en “¿Qué incluye?” ves dominio/hosting/SSL, están cubiertos. En caso contrario, podemos añadirlos como adicionales.</div>
          </details>
          <details class="group bg-gray-800/50 rounded-xl p-4 border border-gray-700">
            <summary class="cursor-pointer text-white font-semibold flex items-center justify-between">
              <span>¿Cómo funciona el soporte y las garantías?</span>
              <i class="fas fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <div class="mt-3 text-gray-300 text-sm">Incluimos soporte por email y WhatsApp. Mantenemos una ventana de correcciones post‑entrega y ofrecemos planes de soporte mensual opcionales.</div>
          </details>
          <details class="group bg-gray-800/50 rounded-xl p-4 border border-gray-700">
            <summary class="cursor-pointer text-white font-semibold flex items-center justify-between">
              <span>¿Qué métodos de pago aceptan?</span>
              <i class="fas fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
            </summary>
            <div class="mt-3 text-gray-300 text-sm">Pagas de forma segura con Wompi (tarjetas, PSE, Nequi y más). La facturación puede ser anual o mensual según el plan.</div>
          </details>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
(function(){
  var btnAdd = document.getElementById('plan-add-to-cart');
  var btnBuy = document.getElementById('plan-buy-now');
  if (!btnAdd || !btnBuy) return;
  var id = '{{ slug }}';
  var name = '{{ plan.title|escapejs }}';
  var price = {{ plan.price|default:0 }};
  var icon = '{{ plan.icon|default:"fa-tag" }}';

  function add(){ try { window.storeCart.addItem(id, name, price, icon, ''); } catch(e) {} }

  btnAdd.addEventListener('click', function(){
    add();
    var fab = document.getElementById('store-fab');
    var badge = document.getElementById('store-fab-badge');
    if (fab) { fab.classList.remove('bounce'); void fab.offsetWidth; fab.classList.add('bounce'); setTimeout(function(){ fab.classList.remove('bounce'); }, 1200); }
    if (badge) { badge.classList.add('show'); }
    var original = btnAdd.innerHTML; btnAdd.disabled = true; btnAdd.innerHTML = '<i class="fas fa-check mr-2"></i> Agregado';
    setTimeout(function(){ btnAdd.disabled = false; btnAdd.innerHTML = original; }, 1200);
  });

  btnBuy.addEventListener('click', function(){ add(); window.location.href = '/tienda/checkout/'; });
})();
</script>
{% endblock %}
